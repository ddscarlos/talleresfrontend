<section class="auth-page-wrapper py-5 position-relative d-flex align-items-center justify-content-center min-vh-100 bg-light">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 offset-lg-1">
        
        <!-- Mensajes -->
        <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
          <strong>Error:</strong> {{ errorMessage }}
          <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
        </div>

        <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
          <strong>Éxito:</strong> {{ successMessage }}
        </div>

        <!-- Contenedor principal -->
        <div class="card border-0 rounded-lg shadow-lg">
          <div class="card-body p-5">
            
            <!-- Header -->
            <div class="text-center mb-5">
              <h2 class="fw-bold mb-2" style="color: #667eea;">Crear tu Cuenta</h2>
              <p class="text-muted">Únete a nuestros talleres culturales</p>
            </div>

            <form [formGroup]="registroForm" (ngSubmit)="onSubmit()" novalidate>
              
              <!-- SECCIÓN 1: DATOS PERSONALES -->
              <div class="form-section mb-4">
                <h5 class="section-title mb-4">Datos Personales</h5>
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="tipo_documento" class="form-label">Tipo de Documento <span class="text-danger">*</span></label>
                    <select 
                      id="tipo_documento"
                      class="form-select"
                      formControlName="tipo_documento"
                      [class.is-invalid]="registroForm.get('tipo_documento')?.invalid && registroForm.get('tipo_documento')?.touched">
                      <option value="">-- Selecciona --</option>
                      <option *ngFor="let tipo of tiposDocumento" [value]="tipo.value">
                        {{ tipo.label }}
                      </option>
                    </select>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label for="numero_documento" class="form-label">Número de Documento <span class="text-danger">*</span></label>
                    <input 
                      type="text" 
                      id="numero_documento" 
                      class="form-control"
                      formControlName="numero_documento"
                      placeholder="Ej: 12345678"
                      [class.is-invalid]="registroForm.get('numero_documento')?.invalid && registroForm.get('numero_documento')?.touched" />
                    <div class="invalid-feedback" *ngIf="registroForm.get('numero_documento')?.invalid && registroForm.get('numero_documento')?.touched">
                      Ingresa un número válido (mínimo 8 dígitos)
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="nombres" class="form-label">Nombres <span class="text-danger">*</span></label>
                    <input 
                      type="text" 
                      id="nombres" 
                      class="form-control"
                      formControlName="nombres"
                      placeholder="Tu(s) nombre(s)"
                      [class.is-invalid]="registroForm.get('nombres')?.invalid && registroForm.get('nombres')?.touched" />
                    <div class="invalid-feedback" *ngIf="registroForm.get('nombres')?.invalid && registroForm.get('nombres')?.touched">
                      Ingresa al menos 2 caracteres
                    </div>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label for="apellidos" class="form-label">Apellidos <span class="text-danger">*</span></label>
                    <input 
                      type="text" 
                      id="apellidos" 
                      class="form-control"
                      formControlName="apellidos"
                      placeholder="Tus apellidos"
                      [class.is-invalid]="registroForm.get('apellidos')?.invalid && registroForm.get('apellidos')?.touched" />
                    <div class="invalid-feedback" *ngIf="registroForm.get('apellidos')?.invalid && registroForm.get('apellidos')?.touched">
                      Ingresa al menos 2 caracteres
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="fecha_nacimiento" class="form-label">Fecha de Nacimiento <span class="text-danger">*</span></label>
                    <input 
                      type="date" 
                      id="fecha_nacimiento" 
                      class="form-control"
                      formControlName="fecha_nacimiento"
                      [class.is-invalid]="registroForm.get('fecha_nacimiento')?.invalid && registroForm.get('fecha_nacimiento')?.touched" />
                    <div class="invalid-feedback" *ngIf="registroForm.get('fecha_nacimiento')?.invalid && registroForm.get('fecha_nacimiento')?.touched">
                      Selecciona una fecha válida
                    </div>
                    <small class="text-muted" *ngIf="registroForm.get('fecha_nacimiento')?.value">
                      Edad: {{ calcularEdad() }} años
                    </small>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label for="sexo" class="form-label">Sexo <span class="text-danger">*</span></label>
                    <select 
                      id="sexo"
                      class="form-select"
                      formControlName="sexo"
                      [class.is-invalid]="registroForm.get('sexo')?.invalid && registroForm.get('sexo')?.touched">
                      <option value="">-- Selecciona --</option>
                      <option value="M">Masculino</option>
                      <option value="F">Femenino</option>
                      <option value="O">Otro</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- SECCIÓN 2: DATOS DE CONTACTO -->
              <div class="form-section mb-4">
                <h5 class="section-title mb-4">Datos de Contacto</h5>
                
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                    <input 
                      type="email" 
                      id="email" 
                      class="form-control"
                      formControlName="email"
                      placeholder="tu@correo.com"
                      [class.is-invalid]="registroForm.get('email')?.invalid && registroForm.get('email')?.touched" />
                    <div class="invalid-feedback" *ngIf="registroForm.get('email')?.invalid && registroForm.get('email')?.touched">
                      Ingresa un email válido
                    </div>
                  </div>

                  <div class="col-md-6 mb-3">
                    <label for="telefono" class="form-label">Teléfono <span class="text-danger">*</span></label>
                    <input 
                      type="tel" 
                      id="telefono" 
                      class="form-control"
                      formControlName="telefono"
                      placeholder="9 XXXXXXXXX"
                      [class.is-invalid]="registroForm.get('telefono')?.invalid && registroForm.get('telefono')?.touched" />
                    <div class="invalid-feedback" *ngIf="registroForm.get('telefono')?.invalid && registroForm.get('telefono')?.touched">
                      Ingresa un número válido (9 dígitos)
                    </div>
                  </div>
                </div>
              </div>

              <!-- SECCIÓN 3: DIRECCIÓN (OPCIONAL) -->
              <div class="form-section mb-4">
                <h5 class="section-title mb-4">Dirección <small class="text-muted">(Opcional)</small></h5>
                
                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label for="departamento" class="form-label">Departamento <span class="text-danger">*</span></label>
                    <select 
                      id="departamento"
                      class="form-select"
                      formControlName="departamento"
                      [class.is-invalid]="registroForm.get('departamento')?.invalid && registroForm.get('departamento')?.touched">
                      <option value="">-- Selecciona --</option>
                      <option *ngFor="let dept of departamentos" [value]="dept.value">
                        {{ dept.label }}
                      </option>
                    </select>
                  </div>

                  <div class="col-md-4 mb-3">
                    <label for="provincia" class="form-label">Provincia <span class="text-danger">*</span></label>
                    <input 
                      type="text" 
                      id="provincia" 
                      class="form-control"
                      formControlName="provincia"
                      placeholder="Ej: Lima"
                      [class.is-invalid]="registroForm.get('provincia')?.invalid && registroForm.get('provincia')?.touched" />
                  </div>

                  <div class="col-md-4 mb-3">
                    <label for="distrito" class="form-label">Distrito <span class="text-danger">*</span></label>
                    <input 
                      type="text" 
                      id="distrito" 
                      class="form-control"
                      formControlName="distrito"
                      placeholder="Ej: San Isidro"
                      [class.is-invalid]="registroForm.get('distrito')?.invalid && registroForm.get('distrito')?.touched" />
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12 mb-3">
                    <label for="direccion" class="form-label">Dirección</label>
                    <input 
                      type="text" 
                      id="direccion" 
                      class="form-control"
                      formControlName="direccion"
                      placeholder="Calle, número, departamento..." />
                  </div>
                </div>
              </div>

              <!-- SECCIÓN 4: SEGURIDAD -->
              <div class="form-section mb-4">
                <h5 class="section-title mb-4">Seguridad</h5>
                
                <div class="mb-3">
                  <label for="password" class="form-label">Contraseña <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input 
                      [type]="mostrarPassword ? 'text' : 'password'"
                      id="password" 
                      class="form-control"
                      formControlName="password"
                      placeholder="Mínimo 8 caracteres"
                      [class.is-invalid]="registroForm.get('password')?.invalid && registroForm.get('password')?.touched" />
                    <button 
                      type="button" 
                      class="btn btn-outline-secondary password-addon"
                      (click)="togglePassword()">
                      <i [class]="mostrarPassword ? 'ri-eye-off-fill' : 'ri-eye-fill'"></i>
                    </button>
                  </div>
                  <div class="invalid-feedback d-block" *ngIf="registroForm.get('password')?.invalid && registroForm.get('password')?.touched">
                    La contraseña debe tener al menos 8 caracteres
                  </div>
                </div>

                <!-- Requisitos de contraseña -->
                <div class="password-requirements mb-3">
                  <p class="mb-2"><strong>Requisitos de contraseña:</strong></p>
                  <ul class="list-unstyled">
                    <li [class.valid]="passwordRequirements.minLength" [class.invalid]="!passwordRequirements.minLength">
                      <i class="ri-check-line"></i> Mínimo 8 caracteres
                    </li>
                    <li [class.valid]="passwordRequirements.hasUpperCase" [class.invalid]="!passwordRequirements.hasUpperCase">
                      <i class="ri-check-line"></i> Al menos una mayúscula
                    </li>
                    <li [class.valid]="passwordRequirements.hasLowerCase" [class.invalid]="!passwordRequirements.hasLowerCase">
                      <i class="ri-check-line"></i> Al menos una minúscula
                    </li>
                    <li [class.valid]="passwordRequirements.hasNumber" [class.invalid]="!passwordRequirements.hasNumber">
                      <i class="ri-check-line"></i> Al menos un número
                    </li>
                  </ul>
                </div>

                <div class="mb-3">
                  <label for="confirmar_password" class="form-label">Confirmar Contraseña <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input 
                      [type]="mostrarConfirmarPassword ? 'text' : 'password'"
                      id="confirmar_password" 
                      class="form-control"
                      formControlName="confirmar_password"
                      placeholder="Repite tu contraseña"
                      [class.is-invalid]="(registroForm.get('confirmar_password')?.invalid || registroForm.errors?.passwordMismatch) && registroForm.get('confirmar_password')?.touched" />
                    <button 
                      type="button" 
                      class="btn btn-outline-secondary password-addon"
                      (click)="toggleConfirmarPassword()">
                      <i [class]="mostrarConfirmarPassword ? 'ri-eye-off-fill' : 'ri-eye-fill'"></i>
                    </button>
                  </div>
                  <div class="invalid-feedback d-block" *ngIf="registroForm.errors?.passwordMismatch && registroForm.get('confirmar_password')?.touched">
                    Las contraseñas no coinciden
                  </div>
                </div>
              </div>

              <!-- TÉRMINOS Y CONDICIONES -->
              <div class="form-check mb-4">
                <input 
                  type="checkbox" 
                  id="terminos" 
                  class="form-check-input"
                  formControlName="terminos"
                  [class.is-invalid]="registroForm.get('terminos')?.invalid && registroForm.get('terminos')?.touched" />
                <label class="form-check-label" for="terminos">
                  Acepto los <a href="#" class="text-decoration-none">términos y condiciones</a> <span class="text-danger">*</span>
                </label>
                <div class="invalid-feedback d-block" *ngIf="registroForm.get('terminos')?.invalid && registroForm.get('terminos')?.touched">
                  Debes aceptar los términos y condiciones
                </div>
              </div>

              <!-- BOTONES -->
              <div class="d-grid gap-2 mb-3">
                <button 
                  type="submit" 
                  [disabled]="loading || registroForm.invalid"
                  class="btn btn-register btn-lg">
                  <span *ngIf="!loading">Registrarse</span>
                  <span *ngIf="loading">
                    <span class="spinner-border spinner-border-sm me-2"></span>
                    Registrando...
                  </span>
                </button>
              </div>

              <!-- ENLACE A LOGIN -->
              <div class="text-center">
                <p class="text-muted mb-0">
                  ¿Ya tienes cuenta? 
                  <a href="javascript:void(0)" (click)="irALogin()" class="text-decoration-none fw-bold" style="color: #667eea;">
                    Inicia sesión aquí
                  </a>
                </p>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
