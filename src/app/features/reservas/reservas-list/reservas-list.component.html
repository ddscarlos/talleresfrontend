<!-- HEADER -->
<section class="py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
  <div class="container">
    <h1 class="display-4 fw-bold mb-2">Mis Reservas</h1>
    <p class="lead opacity-75">Gestiona y controla tus reservas de talleres</p>
  </div>
</section>

<!-- CONTENIDO -->
<section class="py-5">
  <div class="container">
    
    <!-- Mensajes -->
    <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show" role="alert">
      <strong>Error:</strong> {{ errorMessage }}
      <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
    </div>

    <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
      <strong>Ã‰xito:</strong> {{ successMessage }}
      <button type="button" class="btn-close" (click)="successMessage = ''"></button>
    </div>

    <!-- LOADING -->
    <div *ngIf="loading" class="d-flex justify-content-center align-items-center py-5">
      <app-loading-spinner></app-loading-spinner>
    </div>

    <!-- FILTROS -->
    <div *ngIf="!loading && reservas.length > 0" class="mb-4">
      <div class="btn-group" role="group">
        <button 
          *ngFor="let estado of estados"
          type="button" 
          class="btn"
          [class.btn-primary]="filtroEstado === estado.id"
          [class.btn-outline-secondary]="filtroEstado !== estado.id"
          (click)="filtroEstado = estado.id">
          {{ estado.nombre }}
        </button>
      </div>
    </div>

    <!-- SIN RESERVAS -->
    <div *ngIf="!loading && reservas.length === 0" class="text-center py-5">
      <i class="ri-folder-open-line" style="font-size: 80px; color: #ccc;"></i>
      <h3 class="mt-3 text-muted">No tienes reservas</h3>
      <p class="text-muted">Comienza a explorar nuestros talleres y haz tu primera reserva</p>
      <a href="/talleres" class="btn btn-primary btn-lg mt-3">
        <i class="ri-eye-line me-2"></i>
        Explorar Talleres
      </a>
    </div>

    <!-- LISTA DE RESERVAS -->
    <div *ngIf="!loading && obtenerReservasFiltradas().length > 0">
      <div class="row">
        <div *ngFor="let reserva of obtenerReservasFiltradas()" class="col-12">
          <div class="card border-0 rounded-lg mb-3 shadow-sm" [style.borderLeft]="'6px solid ' + getColorEstado(reserva.estado?.esr_nombre || '')">
            <div class="card-body">
              <div class="row align-items-center">
                
                <!-- Info principal -->
                <div class="col-md-6">
                  <h5 class="fw-bold mb-2">
                    <i class="ri-calendar-line" style="color: #667eea; margin-right: 10px;"></i>
                    Reserva #{{ reserva.res_numero }}
                  </h5>
                  <p class="text-muted small mb-1">
                    Registrada el {{ reserva.res_fecha_registro | date:'dd/MM/yyyy HH:mm' }}
                  </p>
                  <p class="text-muted small">
                    <strong>Cupos:</strong> {{ reserva.res_cupos }} | 
                    <strong>Total:</strong> S/{{ reserva.res_precio_total }}
                  </p>
                </div>

                <!-- Estado -->
                <div class="col-md-3">
                  <div class="text-center">
                    <span class="badge" [style.background]="getColorEstado(reserva.estado?.esr_nombre || '')" style="padding: 10px 20px; font-size: 14px;">
                      {{ reserva.estado?.esr_nombre || 'DESCONOCIDO' }}
                    </span>
                  </div>
                </div>

                <!-- Acciones -->
                <div class="col-md-3">
                  <div class="btn-group btn-group-sm w-100" role="group">
                    <button 
                      type="button"
                      class="btn btn-outline-primary"
                      (click)="verDetalle(reserva.res_id)"
                      title="Ver detalles">
                      <i class="ri-eye-line"></i>
                    </button>
                    <button 
                      type="button"
                      class="btn btn-outline-secondary"
                      (click)="descargarPDF(reserva.res_id)"
                      title="Descargar PDF">
                      <i class="ri-file-pdf-line"></i>
                    </button>
                    <button 
                      *ngIf="reserva.estado?.esr_nombre === 'PENDIENTE'"
                      type="button"
                      class="btn btn-outline-success"
                      (click)="realizarPago(reserva.res_id)"
                      title="Realizar pago">
                      <i class="ri-credit-card-line"></i>
                    </button>
                    <button 
                      *ngIf="reserva.estado?.esr_nombre !== 'CANCELADA' && reserva.estado?.esr_nombre !== 'COMPLETADA'"
                      type="button"
                      class="btn btn-outline-danger"
                      (click)="cancelarReserva(reserva.res_id)"
                      title="Cancelar reserva">
                      <i class="ri-delete-bin-line"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Detalles expandibles -->
              <div class="mt-3 pt-3 border-top" *ngIf="reserva.res_observaciones">
                <p class="small text-muted mb-0">
                  <strong>Observaciones:</strong> {{ reserva.res_observaciones }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Sin resultados de filtro -->
    <div *ngIf="!loading && reservas.length > 0 && obtenerReservasFiltradas().length === 0" class="text-center py-5">
      <i class="ri-inbox-line" style="font-size: 80px; color: #ccc;"></i>
      <h3 class="mt-3 text-muted">No hay reservas con este estado</h3>
      <p class="text-muted">Intenta seleccionar otro filtro</p>
    </div>
  </div>
</section>
