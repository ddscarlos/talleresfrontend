<!-- HEADER SECTION -->
<section class="py-5" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
  <div class="container">
    <h1 class="display-4 fw-bold mb-2">Catálogo de Talleres</h1>
    <p class="lead opacity-75">Descubre una amplia variedad de talleres culturales</p>
  </div>
</section>

<!-- SEARCH & FILTER SECTION -->
<section class="py-5" style="background: #f8f9fa;">
  <div class="container">
    <div class="row g-4 mb-4">
      <!-- Búsqueda -->
      <div class="col-lg-6">
        <div class="input-group input-group-lg">
          <span class="input-group-text" style="background: white; border-right: none;">
            <i class="ri-search-line" style="color: #667eea;"></i>
          </span>
          <input 
            type="text" 
            class="form-control"
            placeholder="Buscar talleres..."
            (keyup)="buscar($event.target.value)"
            style="border-left: none; border-right: 1px solid #dee2e6;">
          <button 
            class="btn btn-outline-secondary"
            type="button"
            (click)="loadTalleres()">
            <i class="ri-refresh-line"></i>
          </button>
        </div>
      </div>

      <!-- Filtro por categoría -->
      <div class="col-lg-6">
        <div class="d-flex gap-2 flex-wrap">
          <button 
            *ngFor="let cat of categorias"
            class="btn btn-sm category-pill"
            [class.active]="filtroCategoria === cat.id"
            (click)="filtrarPorCategoria(cat.id)">
            {{ cat.emoji }} {{ cat.nombre }}
          </button>
        </div>
      </div>
    </div>

    <!-- Mostrar filtros activos -->
    <div *ngIf="filtroCategoria || filtroSearch" class="alert alert-info d-flex justify-content-between align-items-center">
      <div>
        <strong>Filtros activos:</strong>
        <span *ngIf="filtroCategoria" class="badge bg-primary me-2">
          Categoría: {{ (categorias | filter: filtroCategoria)[0]?.nombre }}
        </span>
        <span *ngIf="filtroSearch" class="badge bg-primary">
          Búsqueda: "{{ filtroSearch }}"
        </span>
      </div>
      <button class="btn btn-sm btn-outline-secondary" (click)="filtroCategoria = ''; filtroSearch = ''; aplicarFiltros()">
        Limpiar filtros
      </button>
    </div>
  </div>
</section>

<!-- LOADING STATE -->
<div *ngIf="loading" class="d-flex justify-content-center align-items-center py-5">
  <app-loading-spinner></app-loading-spinner>
</div>

<!-- ERROR STATE -->
<div *ngIf="errorMessage && !loading" class="container my-5">
  <div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>Advertencia:</strong> {{ errorMessage }}
    <button type="button" class="btn-close" (click)="errorMessage = ''"></button>
  </div>
</div>

<!-- TALLERES GRID -->
<section class="py-5">
  <div class="container">
    <!-- Sin resultados -->
    <div *ngIf="!loading && talleresFilters.length === 0" class="text-center py-5">
      <i class="ri-inbox-line" style="font-size: 80px; color: #ccc;"></i>
      <h3 class="mt-3 text-muted">No se encontraron talleres</h3>
      <p class="text-muted">Intenta ajustar tus filtros o búsqueda</p>
      <button class="btn btn-primary mt-3" (click)="filtroCategoria = ''; filtroSearch = ''; aplicarFiltros()">
        Ver todos los talleres
      </button>
    </div>

    <!-- Grid de talleres -->
    <div *ngIf="!loading && talleresFilters.length > 0">
      <div class="row g-4 mb-5">
        <div *ngFor="let taller of obtenerTalleresPaginados()" class="col-lg-4 col-md-6">
          <div class="card border-0 rounded-lg shadow-sm h-100 taller-card" style="transition: all 0.3s ease; cursor: pointer;" (click)="verDetalle(taller.tal_id)" (mouseenter)="$event.currentTarget.style.transform='translateY(-10px)'; $event.currentTarget.style.boxShadow='0 10px 30px rgba(102, 126, 234, 0.3)'" (mouseleave)="$event.currentTarget.style.transform='none'; $event.currentTarget.style.boxShadow=''; ">
            
            <!-- Badge de categoría -->
            <div style="position: absolute; top: 15px; right: 15px; z-index: 10;">
              <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 24px; padding: 8px 12px;">
                {{ obtenerEmoji(taller.tal_categoria) }}
              </span>
            </div>

            <!-- Imagen placeholder -->
            <div style="height: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative;">
              <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                <i class="ri-image-add-line" style="font-size: 60px; color: white; opacity: 0.5;"></i>
              </div>
            </div>

            <div class="card-body">
              <!-- Título -->
              <h5 class="card-title fw-bold mb-2" style="color: #667eea;">
                {{ taller.tal_nombre }}
              </h5>

              <!-- Descripción -->
              <p class="card-text text-muted small mb-3">
                {{ taller.tal_descripcion | slice:0:80 }}...
              </p>

              <!-- Requisitos -->
              <div class="mb-3">
                <small class="d-block text-muted">
                  <i class="ri-calendar-line me-1"></i>
                  Duración: {{ taller.tal_duracion }} min
                </small>
                <small class="d-block text-muted">
                  <i class="ri-user-line me-1"></i>
                  Edad: {{ taller.tal_edad_min }}-{{ taller.tal_edad_max }} años
                </small>
                <small class="d-block text-muted">
                  <i class="ri-price-tag-3-line me-1"></i>
                  Desde S/{{ taller.tal_precio_desde }}
                </small>
              </div>

              <!-- Estado -->
              <div class="d-flex justify-content-between align-items-center mb-3">
                <small *ngIf="puedeTomar(taller)" class="badge bg-success">
                  Puedes tomar este taller
                </small>
                <small *ngIf="!puedeTomar(taller)" class="badge bg-warning">
                  No cumples edad
                </small>
              </div>
            </div>

            <!-- Footer -->
            <div class="card-footer bg-white border-top pt-3">
              <button 
                class="btn btn-sm btn-primary w-100"
                [disabled]="!puedeTomar(taller)">
                <i class="ri-eye-line me-1"></i>
                Ver Detalles
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- PAGINACIÓN -->
      <nav *ngIf="obtenerNumerosPaginas().length > 1" class="d-flex justify-content-center" aria-label="Paginación">
        <ul class="pagination">
          <!-- Anterior -->
          <li class="page-item" [class.disabled]="paginacion.pagina === 1">
            <button 
              class="page-link"
              [disabled]="paginacion.pagina === 1"
              (click)="irAPagina(paginacion.pagina - 1)">
              <i class="ri-arrow-left-s-line me-1"></i>
              Anterior
            </button>
          </li>

          <!-- Números -->
          <li *ngFor="let pagina of obtenerNumerosPaginas()" class="page-item" [class.active]="pagina === paginacion.pagina">
            <button 
              class="page-link"
              (click)="irAPagina(pagina)"
              [class.active]="pagina === paginacion.pagina">
              {{ pagina }}
            </button>
          </li>

          <!-- Siguiente -->
          <li class="page-item" [class.disabled]="paginacion.pagina === obtenerNumerosPaginas().length">
            <button 
              class="page-link"
              [disabled]="paginacion.pagina === obtenerNumerosPaginas().length"
              (click)="irAPagina(paginacion.pagina + 1)">
              Siguiente
              <i class="ri-arrow-right-s-line ms-1"></i>
            </button>
          </li>
        </ul>
      </nav>

      <!-- Información -->
      <div class="text-center mt-4 text-muted">
        Mostrando {{ (paginacion.pagina - 1) * paginacion.itemsPorPagina + 1 }}-{{ Math.min(paginacion.pagina * paginacion.itemsPorPagina, paginacion.total) }} de {{ paginacion.total }} talleres
      </div>
    </div>
  </div>
</section>

<!-- ESTILOS -->
<style>
  .category-pill {
    padding: 8px 16px;
    border-radius: 25px;
    border: 2px solid #667eea;
    background: white;
    color: #667eea;
    transition: all 0.3s;
    cursor: pointer;
    font-size: 14px;
  }

  .category-pill:hover, .category-pill.active {
    background: #667eea;
    color: white;
  }

  .taller-card {
    overflow: hidden;
  }

  .taller-card:hover {
    transform: translateY(-10px) !important;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3) !important;
  }
</style>
